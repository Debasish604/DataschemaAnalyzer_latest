{% extends "base.html" %}

{% block title %}Analysis Results - Data Analysis Tool{% endblock %}

{% block content %}
<input type="hidden" id="sessionId" value="{{ session_id }}">

<!-- Alert Container -->
<div id="alertContainer" class="mb-3"></div>

<div class="d-flex justify-content-between align-items-center mb-4" id="analysisHeader">
    <div>
        <h2>Analysis Results</h2>
        <p class="text-muted mb-0" id="sessionName">Loading session...</p>
        <small class="text-muted" id="sessionDetails"></small>
    </div>
    <div class="btn-group">
        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
            <i data-feather="download"></i> Export Results
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" data-export-format="json">
                <i data-feather="file-text"></i> JSON Report
            </a></li>
            <li><a class="dropdown-item" href="#" data-export-format="csv">
                <i data-feather="grid"></i> CSV Export
            </a></li>
            <li><a class="dropdown-item" href="#" data-export-format="html">
                <i data-feather="layout"></i> HTML Report
            </a></li>
            <li><a class="dropdown-item" href="#" data-export-format="txt">
                <i data-feather="file"></i> Text Report
            </a></li>
        </ul>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4" id="summaryCards" style="display: none;">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <i data-feather="file" style="width: 32px; height: 32px;" class="mb-2"></i>
                <h3 class="mb-1" id="totalFiles">-</h3>
                <p class="mb-0">Files Analyzed</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <i data-feather="database" style="width: 32px; height: 32px;" class="mb-2"></i>
                <h3 class="mb-1" id="totalRows">-</h3>
                <p class="mb-0">Total Rows</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <i data-feather="columns" style="width: 32px; height: 32px;" class="mb-2"></i>
                <h3 class="mb-1" id="totalColumns">-</h3>
                <p class="mb-0">Total Columns</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <i data-feather="check-circle" style="width: 32px; height: 32px;" class="mb-2"></i>
                <h3 class="mb-1" id="qualityScore">-</h3>
                <p class="mb-0">Quality Score</p>
            </div>
        </div>
    </div>
</div>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs mb-4" id="analysisTab" role="tablist" style="display: none;">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="data-types-tab" data-bs-toggle="tab" data-bs-target="#data-types" type="button">
            <i data-feather="type"></i> Data Types
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="patterns-tab" data-bs-toggle="tab" data-bs-target="#patterns" type="button">
            <i data-feather="trending-up"></i> Patterns
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="relationships-tab" data-bs-toggle="tab" data-bs-target="#relationships" type="button">
            <i data-feather="link"></i> Relationships
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button">
            <i data-feather="info"></i> Insights
        </button>
    </li>
</ul>

<!-- Main Content Area -->
<div id="analysisContent">
    <div class="d-flex align-items-center justify-content-center py-4">
        <div class="spinner-border text-primary me-2" role="status"></div>
        <span>Loading analysis data...</span>
    </div>
</div>

<div class="tab-content" id="analysisTabContent" style="display: none;">
    <!-- Data Types Tab -->
    <div class="tab-pane fade show active" id="data-types" role="tabpanel">
        <div id="dataTypesContent">
            <!-- Content will be loaded dynamically by JavaScript -->
        </div>
    </div>

    <!-- Patterns Tab -->
    <div class="tab-pane fade" id="patterns" role="tabpanel">
        <div id="patternsContent">
            <!-- Content will be loaded dynamically by JavaScript -->
        </div>
    </div>

    <!-- Relationships Tab -->
    <div class="tab-pane fade" id="relationships" role="tabpanel">
        <div id="relationshipsContent">
            <!-- Content will be loaded dynamically by JavaScript -->
        </div>
    </div>

    <!-- Insights Tab -->
    <div class="tab-pane fade" id="insights" role="tabpanel">
        <div id="insightsContent">
            <!-- Content will be loaded dynamically by JavaScript -->
        </div>
    </div>
</div>

<!-- Chart Container for Visualizations -->
<div class="modal fade" id="chartModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Data Visualization</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <canvas id="analysisChart"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/api.js') }}"></script>
<script src="{{ url_for('static', filename='js/analysis.js') }}"></script>
<script>
    // Initialize analysis page
    document.addEventListener('DOMContentLoaded', function() {
        feather.replace();
        
        // Initialize any charts or interactive elements
        initializeAnalysis();
    });
</script>
{% endblock %}